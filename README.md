## 许可证 (License)

本项目采用 **GNU GPLv3** 协议开源。

[![License: GPL v3](https://img.shields.io/badge/License-GPLv3-blue.svg)](https://www.gnu.org/licenses/gpl-3.0)

---
# X岛离线备份 Reborn

## 1. 核心功能概述
本工具用于对 X岛（nmbxd1.com）特定串及其回复进行**增量备份**。
* **核心特性**：支持资源本地化（图片/CSS）、断点续传、状态检测（存活/沉没/回复串）及批量更新。
* **网络层**：采用 `requests.Session` 实现连接复用，并内置重试策略。

---

## 2. 功能模块详解

### A. Userhash (饼干) 管理
用于处理需鉴权板块（如 /f/故事）的访问权限。

* **状态显示**：左侧标签实时显示饼干状态（有效/失效/未设置）。状态通过请求 `/f/故事` 板块验证。
* **输入框交互**：
    * **默认/隐藏态**：显示掩码，防止隐私泄露。点击输入框切换至**只读态**（明文显示，允许复制）。
    * **焦点逻辑**：光标移出且未开启修改模式时，自动回滚至隐藏态。
* **修改 (Checkbox)**：勾选后解除输入框只读限制，允许编辑。
* **保存 (Button)**：将当前 Userhash 写入同级目录下的 `user_config.json` 并立即触发有效性检查。

### B. 任务信息 (Task Info)
单线程任务配置及批量操作区域。

* **串号**：目标串 ID。
* **检查访问权限/更新/下载状态 (Button)**：
    1.  **前置检查**：验证 Userhash 权限及目标串在线状态 (200/404)。
    2.  **本地比对**：扫描保存路径下该 ID 文件夹内的 `page_*.html`，获取本地最大页数。
    3.  **增量逻辑**：
        * 若 `本地页数 < 在线页数`：自动将**起始页**设置为本地最大页数（覆盖下载最后一页以同步最新回复）。
        * 若 `本地页数 == 在线页数`：弹窗询问是否强制重下最后一页。
    4.  **状态标记**：若检测到串状态变更（如变更为回复串、已删除但本地有存档），会自动重命名本地文件夹（追加 `_回复串`、`_已不存在` 或 `_幸存` 后缀）。

* **一键更新已备份 (Button)**：
    * **遍历逻辑**：扫描保存路径下所有纯数字命名的文件夹。
    * **过滤机制**：自动跳过后缀为 `_已不存在`、`_回复串` 或 `_幸存` 的目录。
    * **执行动作**：对剩余目录逐个执行“检查更新”逻辑，仅下载新增页码。

* **起始页设置**：手动/自动指定下载起点。若设置值 > 在线总页数，任务将自动跳过。
* **进度条**：可视化展示 `本地已存页数 / 在线总页数` 比例。

### C. 保存与格式 (IO Config)
* **保存位置**：默认为程序所在目录下的 `\离线内容`。支持自定义路径。
* **保存形式**：
    * **仅保存文件夹**：保留 HTML 及 `assets` 资源目录。
    * **仅保存为压缩包**：下载完成后打包为 ZIP 并删除源文件夹。
    * **文件夹+压缩包**：保留双份。

### D. 执行控制
* **GitHub 仓库**：调用系统浏览器打开项目源码页。
* **开始备份/停止**：启动时创建守护线程；停止时触发 `Event` 标志位，程序将在当前页下载完成后终止，保证单页文件完整性。
* **暂停/继续**：挂起/恢复下载线程。

---

## 3. 技术特性说明

* **资源本地化**：自动解析 HTML 中的 `<img>`、`<link>` 及 CSS 中的 `url()`，下载资源至 `./assets/` 并重写相对路径，确保离线浏览体验与在线一致。
* **元数据记录**：每次备份结束会在目录下生成 `backup_info.json`，记录备份时间、总页数及最后检测到的串状态。
* **幸存者逻辑**：若在线返回 404 但本地存在有效备份，文件夹将被标记为 `_幸存` 并锁定，防止空数据覆盖本地存档。
* **容错机制**：针对 HTTP 500/502/503/504 错误配置了 3 次指数退避重试。

---

## 4. 免责声明

请参阅项目中的免责声明部分。下载或运行本程序即代表您同意相关条款。本工具仅供个人数据备份使用，请自觉遵守目标网站规则。

##  免责声明 (Disclaimer)

>  **注意**：请务必阅读下方的免责声明，**下载或运行本程序即代表您同意该声明**。
> 
> 在使用“X岛离线备份 Reborn”（以下简称“本软件”）之前，请务必仔细阅读并同意以下条款。一旦您开始使用本软件，即表示您已接受并同意受本声明的约束。

### 1. 使用目的
* 本软件仅供**个人学习、技术研究及个人数据备份**使用。
* 开发者编写本软件旨在演示 Python 网络请求、GUI 开发及数据处理技术。
* **请勿将本软件用于任何商业用途或不正当用途。**

### 2. 合规性与责任
* **服务器压力**：使用者应自觉遵守目标网站（X岛/nmbxd1.com）的 `robots.txt` 协议（如有）及相关用户协议。请合理控制下载频率和并发数，**严禁使用本软件对目标网站发起高频请求或恶意攻击（如 DoS/DDoS）。**
* **后果自负**：因使用本软件产生的任何后果（包括但不限于：IP 地址被目标网站封禁、账号/饼干（Userhash）被冻结、数据丢失、法律纠纷等），均由**使用者自行承担**。开发者不对任何因使用本软件而导致的直接或间接损失负责。

### 3. 数据隐私与安全
* **本地存储**：本软件需要用户提供 Userhash 以访问特定内容。该数据**仅保存在用户本地设备**的配置文件中，**不会**上传至开发者服务器或任何第三方平台。
* **用户责任**：请妥善保管您的 Userhash 及生成的备份文件。因任何原因导致的信息泄露，开发者不承担任何责任。

### 4. 版权说明
* **内容版权**：本软件抓取的所有内容的版权均归**原作者及目标网站所有**。本软件仅作为下载工具，不享有这些内容的版权。
* **传播限制**：请勿公开传播抓取到的受版权保护的内容，否则可能侵犯原作者或目标网站的权益。

### 5. 软件担保
本软件按“**原样 (AS IS)**”提供，不包含任何形式的明示或暗示担保（包括但不限于适销性、特定用途适用性及不侵权担保）。开发者不保证本软件一定能满足您的需求，也不保证软件运行过程中不会出现中断或错误。
